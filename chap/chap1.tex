% Copyright (c) 2014,2016,2018 Casper Ti. Vector
% Public domain.

\chapter{引言}
\section{研究背景及意义}
地形是虚拟现实应用中的重要组成部分，大规模地形的真实感可以有效提升虚拟现实应用的沉浸感和应用效果：开放式游戏通常构建大规模、高真实感的虚拟地形让玩家去探索；电影中需要构建现实中不存在的或难以拍摄的地形场景；虚拟战场、飞行模拟等应用需要构建各种用途的地形场景。为了满足上述的虚拟现实应用对地形场景的不同要求，设计专门的地形编辑工具是一项很有意义的工作。\par
真实世界中的地形复杂多变，它的形成是自然环境中的各种元素长期相互作用的结果，如逐渐侵蚀影响的风力和水力、山体滑坡、闪电等。不同的地形特征在不同的尺度上呈现，冰川和板块运动的影响范围可能跨越数十至数百公里，而某些水力和风力侵蚀效果仅在几米的尺度内显现。这些不同尺度的特征还可以出现在同一个地形场景中。因此，地形编辑器需要提供各种尺度的选择工具，并提供不同尺度上的高效编辑方法。\par
目前的地形编辑器主要有三种类型：游戏开发引擎的一部分，如Unreal\supercite{unreal}、CryEngine\supercite{cry-engine}、 Unity3D \supercite{unity}等； 特效编辑引擎的一部分，如houdini\supercite{houdini}）；独立的地形编辑软件，如Terragen\supercite{terragen}、World Machine\supercite{world-machine}等。地形编辑器的编辑对象包括地形高程和地表的纹理。 Unity、Unreal 等地形编辑器还包括植被等地理要素以及建筑等地物的编辑。 Eric等\supercite{eric-review}对地形生成领域的问题进行了分析和归类，指出地形生成的四个最主要的挑战：大规模精细地形的表示、地形材质的应用、地形形状的精细控制和地形的地理真实性。目前地形高程生成主流的解决方案有四类：（1）基于分形噪声的过程式方法\supercite{Belhadj2007Terrain}可以快速生成地形，但缺乏对创作过程的直接控制，且结果缺乏地理学上的真实性。（2）基于样例的方法\supercite{TasseEnhanced}在与深度学习方法结合时可以生成非常逼真的效果，但对于每种特定的地形（山脉、丘陵、河流、高原等）都需要上游的训练阶段。（3）基于物理仿真的方法\supercite{Mei2007Fast}通常基于真实物理世界中的热力学、水力学、地质学等规则对地形进行腐蚀，其迭代过程模拟了真实世界的地形形成过程，因此可以产生非常真实的效果，但无法让艺术家或设计师直观有效的控制生成过程。（4）基于草图的地形生成方法\supercite{Zhou2007Terrain}提供了直观的工具来控制地形形状，但生成的地形往往真实感较差。此外，当编辑区域比较大的时候，手工编辑和基于草图的生成方法时间开销很大。\par
当前，飞行模拟视景系统、虚拟战场有着广泛的应用。对地形场景的构建也提出了更高要求。本文工作在 ViWo（Virtual World）系统平台的基础之上围绕地形场景的编辑展开。ViWo为北京大学图形与交互技术实验室研发的虚拟现实系统平台，包含了面向飞行模拟器的视景仿真系统和复杂场景绘制引擎，支持从全球尺度到近地面尺度的三维场景漫游。由于数据规模的原因，ViWo中的地形以分层四叉树的形式组织和管理。而一种类似LRU的数据缓冲技术用于ViWo的地形绘制。因此，在基于四叉树的地形编辑时，需要将四叉树某个层级的编辑结果同步到整个四叉树上，数据同步和LRU的数据缓冲策略导致大规模地形实时编辑的实现复杂度很高。如何设计和实现一个高效的大规模地形场景编辑框架是本文的主要工作。
\section{本文主要内容}
本文围绕地形场景编辑展开。设计并实现一个大规模地形场景的编辑框架。着重提升在地形高程和地表纹理编辑的效果和效率。本文的主要内容包括：\par
（一）基于分层四叉树的地形编辑框架。对地形高程和纹理的实时编辑框架进行设计和实现。\par
（二）提出一种基于地形高程规则的纹理笔刷，通过调整自定义规则中的高度区间、斜率区间、过渡带宽度等参数，定制符合真实世界地物分布规律的笔刷规则。用户可以在每一笔编辑之前灵活的选择是否应用规则，并用简单的涂抹快速构建出具有真实感的地表纹理。\par
（三）实现一种过程式地面纹理渲染技术，通过贴花技术和颜色提取技术在实时渲染中以较低的开销为地面纹理添加丰富细节，并通过对夏季卫星影像进行色调调整，实现了不同季节的效果。\par
（四）提出一种定义地形语义信息的方法，实现基于高程和纹理数据的语义数据生成，支持对语义的可视化和编辑。最后给出使用语义信息渲染海洋的实例。\par
\section{本文结构}
本文组织结构如下：\par
第一章为引言，介绍大规模场景地形编辑器的研究背景、主要问题、研究意义及文章的主要内容。\par
第二章为相关工作综述，对大规模地形场景生成相关领域的已有工作和技术进行了简要介绍。\par
第三章介绍了本文所设计和实现的地形编辑器的架构，对编辑器中地形数据的管理调度、编辑流程、编辑操作撤销和重做、编辑结果保存及加载等方面的问题及解决方案进行了阐述。\par
第四章介绍了地形高程编辑的实现，包括基于笔刷、选区等交互形式实现的地形升降、平滑、平整等操作，及地形高程编辑的中间结果的保存和加载。\par
第五章介绍了地形纹理编辑的实现，包括基于笔刷在多个图层上进行纹理编辑，提出了基于高程规则的纹理画刷，使地表纹理编辑可以符合地形高程特征。使用贴花技术实现了基于粗糙卫星影像的纹理细节增强，提升了近地漫游时的真实感。提出了一种方法对卫星影像进行色调调整，以呈现不同季节的地表纹理效果。\par
第六章介绍了本文对地形语义信息的定义，提出了基于已有的高程和纹理数据生成语义数据的方法。基于纹理编辑框架支持了语义编辑，提供了语义信息的可视化，并给出了一个使用语义信息指导渲染的实例。\par
第七章对本文工作进行了总结，提出了进一步研究的方向。

%\pkuthssffaq % 中文测试文字。

% vim:ts=4:sw=4
